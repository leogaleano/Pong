<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hello!</title>
</head>

<body>
<div id="root" style="text-align: center;">
  <div fw-if="isPageLogIn">
    <form fw-on:submit="submitLogIn">
      <h1>Log in</h1>

      <input
              type="text"
              name="username"
              fw-attr:value="username"
              fw-on:change="changeUsername"
              placeholder="Username or email"
      />
      <input
              type="password"
              name="password"
              fw-attr:value="password"
              fw-on:change="changePassword"
              placeholder="Password"
      />

      <input type="submit" value="log in" />

      <p fw-if="isFormInvalid">
        Validation error: <span fw-content="validationMessage"></span>
      </p>
    </form>
  </div>
  <div fw-if="isPageMain">
    <h1>Demo app</h1>
    <p>
      Hello, <span fw-content="username"></span>: this is the main page of a
      demo app.
    </p>
  </div>
</div>

  <script>
    let appState = {};

    window.createApp = ({
      rootElementId,
      initialState,
      handlers
    }) => {
      appState = initialState;
      setVisibility(appState);

      setOnChangeListeners(handlers);
      setOnSubmitListeners(handlers);
    }

    setVisibility = (state) => {
      document.querySelectorAll('[fw-if]').forEach(e => {
        e.style.display = (state[e.getAttribute('fw-if')]) ? 'block' : 'none';
      });
    }

    setContent = (state) => {
      document.querySelectorAll('[fw-content]').forEach(e => {
        e.innerHTML = state[e.getAttribute('fw-content')];
      });
    }

    setAttributeValues = (state) => {
      document.querySelectorAll('[fw-attr\\:value]').forEach(e => {
        e.setAttribute('fw-attr:value', state[e.getAttribute('name')]);
        console.log(e);
      });
    }

    setOnChangeListeners = (handlers) => {
      document.querySelectorAll('[fw-on\\:change]').forEach(e => {
        e.addEventListener('change', (event) => {
          let handler = handlers[e.getAttribute('fw-on:change')];

          appState = handler(appState, event);
          setAttributeValues(appState);
        });
      });
    }

    setOnSubmitListeners = (handlers) => {
      document.querySelectorAll('[fw-on\\:submit]').forEach(e => {
        e.addEventListener('submit', (event) => {
          let handler = handlers[e.getAttribute('fw-on:submit')];

          appState = handler(appState, event);
          setVisibility(appState);
          setContent(appState)
        });
      });
    }

  </script>

  <script>
    window.createApp({
      rootElementId: "root",
      initialState: {
        isPageLogIn: true,
        isPageMain: false,
        username: "",
        password: "",
        isFormInvalid: false,
        validationMessage: "",
      },
      handlers: {
        changeUsername: (currentState, event) => {
          const username = event.target.value;
          return {
            ...currentState,
            isFormInvalid: false,
            username,
          };
        },
        changePassword: (currentState, event) => {
          const password = event.target.value;
          return {
            ...currentState,
            isFormInvalid: false,
            password,
          };
        },
        submitLogIn: (currentState, event) => {
          event.preventDefault();

          if (currentState.username === "") {
            return {
              ...currentState,
              isFormInvalid: true,
              validationMessage: "You must provide a username",
            };
          }

          if (currentState.password.length < 8) {
            return {
              ...currentState,
              isFormInvalid: true,
              validationMessage:
                      "The password must contain at least 8 characters",
            };
          }

          return {
            ...currentState,
            isFormInvalid: false,
            isPageLogIn: false,
            isPageMain: true,
          };
        },
      },
    });
  </script>
</body>
</html>